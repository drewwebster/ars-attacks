<html>
<head>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/three.js/94/three.min.js'></script>
  <script src='https://cdn.jsdelivr.net/npm/three.ar.js@latest/dist/three.ar.js'></script>
  <script src='js/device.js'></script>
  <script>
    var arDisplay = false;
    var vrDisplay = false;
    var ready = {
      arDetect: false,
      vrDetect: false
    }

    if (navigator.getVRDisplays) {
      navigator.getVRDisplays().then(function (displays) {
        vrDisplay = displays.length && displays[0];
        ready.vrDetect = true;
        checkReady()
      });
    } else {
      ready.vrDetect = true;
      checkReady()
    }
    
    THREE.ARUtils.getARDisplay().then(function (display) { 
      arDisplay = display;
      if (!arDisplay) {
        // Check if the low-level WebXR Viewer interfaces are there.
        if (window.webkit && window.webkit.messageHandlers) { 
          if (window.webkit.messageHandlers.watchAR) { 
              // Mozilla WebXR Viewer detected.
              arDisplay = true;
           }
        }  
      }
      ready.arDetect = true;
      checkReady()
    })

    function checkReady() {
      if (ready.arDetect && ready.vrDetect) {
        if (arDisplay) {
          window.location.href = 'index-ar.html'
        } else if (vrDisplay) {
          window.location.href = 'index-vr.html'
        } else {
          window.location.href = 'index-desktop.html'
        }
      }
    }
  </script>
</head>
<body></body>
</html>